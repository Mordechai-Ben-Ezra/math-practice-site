<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ† ×ª×¨×’×•×œ ×—×©×‘×•×Ÿ ×× ×¦×—</title>
  <style>
    :root { --primary: #007bff; --success: #28a745; --error: #dc3545; --bg: #f0f4f8; --card: #fff; --text: #333; --radius: 8px; --transition: .3s; --opt1: #ffadad; --opt2: #ffd6a5; --opt3: #caffbf; --opt4: #9bf6ff; }
    * { box-sizing: border-box; }
    body { margin: 0; padding: 1rem; font-family: 'Luckiest Guy', cursive; background: var(--bg); color: var(--text); }
    h1,h2 { text-align: center; color: var(--primary); margin: .5em 0; }
    main { max-width: 600px; margin: auto; position: relative; }
    section { display: none; background: var(--card); border-radius: var(--radius); padding: 1rem; margin-bottom: 1.5rem; }
    section.active { display: flex; flex-direction: column; align-items: stretch; gap: 1rem; }
    #openSettings, #closeSetup { position: absolute; top: 1rem; background: none; border: none; font-size: 1.5rem; cursor: pointer; }
    #openSettings { left: 1rem; }
    #closeSetup { right: 1rem; }
    .modes-row { display: flex; gap: .5rem; width: 100%; }
    .mode-btn { flex: 1; padding: 1rem; border: none; border-radius: var(--radius); background: var(--primary); color: #fff; font-size: 1.5rem; cursor: pointer; }
    .mode-btn.selected { background: var(--success); }
    #startQuiz, .primary { width: 100%; padding: 1rem; font-size: 1.2rem; border: none; border-radius: var(--radius); background: var(--primary); color: #fff; cursor: pointer; }
    #startQuiz.hidden, #applySettings.hidden { display: none; }
    .input-group { display: flex; gap: .5rem; align-items: center; margin-bottom: 1rem; }
    input[type=number] { width: 4rem; padding: .4rem; border: 1px solid #ccc; border-radius: var(--radius); }
    #scoreboard { visibility: hidden; text-align: center; font-size: 1.2rem; }
    #question { width: 100%; text-align: center; font-size: 1.5em; direction: ltr; }
    .option-btn { display: block; width: 100%; padding: 1rem; min-height: 3rem; margin: .5rem 0; border: none; border-radius: var(--radius); cursor: pointer; }
    #options { width: 100%; }
    .option-btn.opt1 { background: var(--opt1); }
    .option-btn.opt1 { background: var(--opt1); }
    .option-btn.opt2 { background: var(--opt2); }
    .option-btn.opt3 { background: var(--opt3); }
    .option-btn.opt4 { background: var(--opt4); }
    .option-btn.correct { background: var(--success) !important; color: #fff; }
    .option-btn.wrong { background: var(--error) !important; color: #fff; }
    #detailModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); align-items: center; justify-content: center; }
    #detailModal.show { display: flex; }
    .modal-content { background: #fff; padding: 1rem; border-radius: var(--radius); width: 90%; max-width: 400px; }
  </style>
</head>
<body>
<main>
  <h1>ğŸ† ×ª×¨×’×•×œ ×—×©×‘×•×Ÿ ×× ×¦×—</h1>
  <section id="mainMenu" class="active">
    <button id="openSettings">âš™ï¸</button>
    <div class="modes-row">
      <button class="mode-btn" data-type="add">â•</button>
      <button class="mode-btn" data-type="sub">â–</button>
    </div>
    <div class="modes-row">
      <button class="mode-btn" data-type="mul">âœ–ï¸</button>
      <button class="mode-btn" data-type="div">â—</button>
    </div>
    <button class="mode-btn" data-type="mix">ğŸ”€</button>
    <button id="startQuiz" class="primary hidden">×”×ª×—×œ ×‘×ª×¨×’×•×œ</button>
  </section>
  <section id="setup">
    <button id="closeSetup">âœ–ï¸</button>
    <h2>×”×’×“×¨×•×ª ×”×ª×¨×’×•×œ</h2>
    <div class="input-group"><label for="min">×</label><input id="min" type="number" value="1"></div>
    <div class="input-group"><label for="max">×¢×“</label><input id="max" type="number" value="10"></div>
    <div class="input-group"><label for="count">××¡×¤×¨ ×ª×¨×’×™×œ×™×</label><input id="count" type="number" value="5"></div>
    <div class="input-group"><label for="timePerQ">×–××Ÿ ×œ×©××œ×”</label><input id="timePerQ" type="number" value="15"></div>
    <button id="applySettings" class="primary hidden">×©××•×¨ ×”×’×“×¨×•×ª</button>
  </section>
  <section id="quiz">
    <div id="scoreboard">× ×§×•×“×•×ª: <span id="score">0</span></div>
    <h2>×ª×¨×’×™×œ <span id="currentNum"></span> ××ª×•×š <span id="totalNum"></span></h2>
    <div><progress id="progress" max="100" value="0"></progress><span id="progressText">0%</span></div>
    <div id="timer">×–××Ÿ × ×•×ª×¨: <span id="timeDisplay"></span></div>
    <div id="question"></div>
    <div id="options"></div>
  </section>
  <section id="results">
    <h2>×”×ª×•×¦××•×ª ×©×œ×š</h2>
    <ul id="resultsList"></ul>
    <button id="restart" class="primary">× ×¡×” ×©×•×‘</button>
  </section>
</main>
<div id="detailModal"><div class="modal-content"><h3 id="detailTitle"></h3><p id="detailQuestion"></p><p id="detailYour"></p><p id="detailCorrect"></p><button id="detailClose">×¡×’×•×¨</button></div></div>
<audio id="soundCorrect" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="soundWrong" src="https://actions.google.com/sounds/v1/cartoon/metal_hit_and_slide.ogg"></audio>
<audio id="soundCheer" src="https://actions.google.com/sounds/v1/cartoon/cheer.ogg"></audio>
<script>
  document.addEventListener('DOMContentLoaded', () => {
    const screens = {
      mainMenu: document.getElementById('mainMenu'),
      setup: document.getElementById('setup'),
      quiz: document.getElementById('quiz'),
      results: document.getElementById('results')
    };
    function showScreen(name) {
      Object.values(screens).forEach(s => s.classList.remove('active'));
      screens[name].classList.add('active');
    }
    let settings = { min: 1, max: 10, count: 5, perQ: 15 };
    let selectedTypes = new Set();
    const modeBtns = document.querySelectorAll('.mode-btn');
    const openSettings = document.getElementById('openSettings');
    const closeSetup = document.getElementById('closeSetup');
    const applySettings = document.getElementById('applySettings');
    const startQuiz = document.getElementById('startQuiz');
    const restart = document.getElementById('restart');
    const detailClose = document.getElementById('detailClose');
    const scoreBoard = document.getElementById('scoreboard');
    const scoreEl = document.getElementById('score');
    const currentNumEl = document.getElementById('currentNum');
    const totalNumEl = document.getElementById('totalNum');
    const questionEl = document.getElementById('question');
    const optionsEl = document.getElementById('options');
    const timerEl = document.getElementById('timeDisplay');
    const progressBar = document.getElementById('progress');
    const progressText = document.getElementById('progressText');
    const resultsList = document.getElementById('resultsList');
    const soundC = document.getElementById('soundCorrect');
    const soundW = document.getElementById('soundWrong');
    const soundCh = document.getElementById('soundCheer');
    let exercises = [], answers = [], userAnswers = [], currentIndex = 0, countdown, score = 0;
    modeBtns.forEach(btn => {
      btn.addEventListener('click', () => {
        const type = btn.dataset.type;
        if (type === 'mix') {
          selectedTypes.clear();
          modeBtns.forEach(b => b.classList.remove('selected'));
          selectedTypes.add('mix');
          btn.classList.add('selected');
        } else {
          if (selectedTypes.has('mix')) {
            selectedTypes.delete('mix');
            document.querySelector('[data-type="mix"]').classList.remove('selected');
          }
          if (selectedTypes.has(type)) {
            selectedTypes.delete(type);
            btn.classList.remove('selected');
          } else {
            selectedTypes.add(type);
            btn.classList.add('selected');
          }
          const basic = ['add','sub','mul','div'];
          if (basic.every(t => selectedTypes.has(t))) {
            basic.forEach(t => {
              selectedTypes.delete(t);
              document.querySelector(`[data-type="${t}"]`).classList.remove('selected');
            });
            selectedTypes.add('mix');
            document.querySelector('[data-type="mix"]').classList.add('selected');
          }
        }
        startQuiz.classList.toggle('hidden', selectedTypes.size === 0);
      });
    });
    openSettings.addEventListener('click', () => {
      showScreen('setup');
      applySettings.classList.add('hidden');
    });
    closeSetup.addEventListener('click', () => showScreen('mainMenu'));
    ['min','max','count','timePerQ'].forEach(id => {
      document.getElementById(id).addEventListener('input', () => applySettings.classList.remove('hidden'));
    });
    applySettings.addEventListener('click', () => {
      settings.min = +document.getElementById('min').value;
      settings.max = +document.getElementById('max').value;
      settings.count = +document.getElementById('count').value;
      settings.perQ = +document.getElementById('timePerQ').value;
      applySettings.classList.add('hidden');
      showScreen('mainMenu');
    });
    startQuiz.addEventListener('click', () => {
      const {min,max,count,perQ} = settings;
      exercises = Array.from({length: count}, () => gen(Array.from(selectedTypes), min, max));
      answers = [];
      userAnswers = [];
      currentIndex = 0;
      score = 0;
      totalNumEl.textContent = exercises.length;
      scoreBoard.style.visibility = 'visible';
      scoreEl.textContent = 0;
      showScreen('quiz');
      showQuestion();
    });
    restart.addEventListener('click', () => showScreen('mainMenu'));
    detailClose.addEventListener('click', () => detailModal.classList.remove('show'));
    function gen(types, min, max) {
      const ops = types.includes('mix') ? ['add','sub','mul','div'] : types;
      const op = ops[Math.floor(Math.random()*ops.length)];
      let A = Math.floor(Math.random()*(max-min+1))+min;
      let B = Math.floor(Math.random()*(max-min+1))+min;
      let q, ans;
      switch(op) {
        case 'add': q = `${A} + ${B}`; ans = A+B; break;
        case 'sub': if(A<B)[A,B]=[B,A]; q = `${A} - ${B}`; ans = A-B; break;
        case 'mul': q = `${A} Ã— ${B}`; ans = A*B; break;
        case 'div': B = B||1; A = B * Math.floor(Math.random()*(max-min+1))+min; q = `${A} Ã· ${B}`; ans = A/B; break;
      }
      return {q, ans};
    }
    function showQuestion() {
      clearInterval(countdown);
      const {q, ans} = exercises[currentIndex];
      currentNumEl.textContent = currentIndex + 1;
      questionEl.textContent = q;
      optionsEl.innerHTML = '';
      answers.push(ans);
      const parts = q.split(' ');
      const A = parseInt(parts[0], 10);
      const op = parts[1];
      const B = parseInt(parts[2], 10);
      const choices = new Set([ans]);
      let candidates = [];
      if (op === 'Ã—') candidates = [A * (B - 1), A * (B + 1), (A - 1) * B, (A + 1) * B];
      else if (op === '+') candidates = [A + (B - 1), A + (B + 1), (A - 1) + B, (A + 1) + B];
      else if (op === '-') candidates = [(A + 1) - B, (A - 1) - B, A - (B + 1), A - (B - 1)];
      else if (op === 'Ã·') candidates = [ans + 1, ans - 1, ans * 2, Math.floor(ans / 2)];
      for (const c of candidates) {
        if (choices.size >= 4) break;
        if (c >= 0 && c !== ans) choices.add(c);
      }
      if (choices.size < 4) {
        while (choices.size < 4) {
          let c = Math.floor(Math.random() * ((ans + 10) - (ans - 10) + 1)) + (ans - 10);
          if (c >= 0 && c !== ans) choices.add(c);
        }
      }
      Array.from(choices).sort(() => Math.random() - 0.5).forEach((val, i) => {
        const btn = document.createElement('button');
        btn.textContent = val;
        btn.className = `option-btn opt${i + 1}`;
        btn.addEventListener('click', () => selectAnswer(btn, val, ans));
        optionsEl.append(btn);
      });
      const pct = Math.round((currentIndex / exercises.length) * 100);
      progressBar.value = pct;
      progressText.textContent = pct + '%';
      timerEl.textContent = settings.perQ;
      countdown = setInterval(() => {
        let t = +timerEl.textContent - 1;
        timerEl.textContent = t;
        if (t <= 0) { clearInterval(countdown); selectAnswer(null, null, ans); }
      }, 1000);
    }
    function selectAnswer(btn, val, correct) {
      clearInterval(countdown);
      userAnswers.push(val);
      optionsEl.querySelectorAll('button').forEach(b => {
        b.disabled = true;
        if(+b.textContent === correct) b.classList.add('correct');
      });
      if(btn && val === correct) {
        soundC.play();
        const pts = Math.ceil(+timerEl.textContent * 2);
        score += pts;
        scoreEl.textContent = score;
      }
      if(btn && val !== correct) { btn.classList.add('wrong'); soundW.play(); }
      setTimeout(()=>{
        if(currentIndex + 1 < exercises.length) { currentIndex++; showQuestion(); }
        else {
          showScreen('results');
          resultsList.innerHTML = '';
          exercises.forEach((ex,i) => {
            const li = document.createElement('li');
            li.textContent = `×ª×¨×’×™×œ ${i+1}`;
            li.addEventListener('click', () => {
              document.getElementById('detailTitle').textContent = `×ª×¨×’×™×œ ${i+1}`;
              document.getElementById('detailQuestion').textContent = `×©××œ×”: ${ex.q}`;
              document.getElementById('detailYour').textContent = `×”×ª×©×•×‘×” ×©×œ×š: ${userAnswers[i]}`;
              document.getElementById('detailCorrect').textContent = `×”×ª×©×•×‘×” ×”× ×›×•× ×”: ${answers[i]}`;
              detailModal.classList.add('show');
            });
            resultsList.append(li);
          });
          soundCh.play();
        }
      },1000);
    }
  });
</script>
