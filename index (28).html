<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>

  <!-- SEO ×•×”×ª×××” ×œ×’×•×’×œ -->
  <meta name="robots" content="index, follow" />
  <meta name="description" content="×ª×¨×’×•×œ ×—×©×‘×•×Ÿ ××ª××˜×™ ×‘×›×™×£: ×—×™×‘×•×¨, ×—×™×¡×•×¨, ×›×¤×œ ×•×—×™×œ×•×§ ×‘×¨××•×ª ×©×•× ×•×ª. ×©×¤×¨×• ××”×™×¨×•×ª ×•×“×™×•×§ ×‘×œ×™××•×“ ×¢×¦××™." />
  <meta name="keywords" content="×ª×¨×’×•×œ ×—×©×‘×•×Ÿ, ×—×©×‘×•×Ÿ ××”×™×¨, ×—×™×‘×•×¨, ×—×™×¡×•×¨, ×›×¤×œ, ×—×™×œ×•×§, ×œ××™×“×” ×¢×¦×××™×ª" />
  <link rel="canonical" href="https://Mordechai-Ben-Ezra.github.io/math-practice-site/" />

  <!-- Open Graph -->
  <meta property="og:title" content="×ª×¨×’×•×œ ×—×©×‘×•×Ÿ ×× ×¦×—" />
  <meta property="og:description" content="×ª×¨×’×•×œ ×—×©×‘×•×Ÿ ×‘×ª×¨×’×™×œ×™× ××’×•×•× ×™× ×•×‘×›×™×£ â€“ ×œ×—×™×‘×•×¨, ×—×™×¡×•×¨, ×›×¤×œ ×•×—×™×œ×•×§." />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://Mordechai-Ben-Ezra.github.io/math-practice-site/" />
  <meta property="og:image" content="https://Mordechai-Ben-Ezra.github.io/math-practice-site/images/preview.png" />

  <!-- JSON-LD -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "WebSite",
    "url": "https://Mordechai-Ben-Ezra.github.io/math-practice-site/",
    "name": "×ª×¨×’×•×œ ×—×©×‘×•×Ÿ ×× ×¦×—",
    "description": "×ª×¨×’×•×œ ×—×©×‘×•×Ÿ ××ª××˜×™ ×‘×›×™×£: ×—×™×‘×•×¨, ×—×™×¡×•×¨, ×›×¤×œ ×•×—×™×œ×•×§ ×‘×¨××•×ª ×©×•× ×•×ª."
  }
  </script>

  <title>ğŸ† ×ª×¨×’×•×œ ×—×©×‘×•×Ÿ ×× ×¦×—</title>
  <style>
    :root {
      --primary: #007bff;
      --success: #28a745;
      --error: #dc3545;
      --bg: #f0f4f8;
      --card: #fff;
      --text: #333;
      --radius: 8px;
      --transition: .3s;
      --opt1: #ffadad;
      --opt2: #ffd6a5;
      --opt3: #caffbf;
      --opt4: #9bf6ff;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0; padding: 1rem;
      font-family: 'Luckiest Guy', cursive;
      background: var(--bg); color: var(--text);
    }
    h1,h2 { text-align: center; color: var(--primary); margin: .5em 0; }
    main { max-width: 600px; margin: auto; position: relative; }
    section { display: none; background: var(--card); border-radius: var(--radius); padding: 1rem; margin-bottom: 1.5rem; }
    section.active { display: flex; flex-direction: column; gap: 1rem; }
    #openSettings, #closeSetup { position: absolute; top: 1rem; background: none; border: none; font-size: 1.5rem; cursor: pointer; }
    #openSettings { left: 1rem; }
    #closeSetup { right: 1rem; }
    .modes-row { display: flex; gap: 0.5rem; width: 100%; }
    .mode-btn { flex: 1; padding: 1rem; border: none; border-radius: var(--radius); background: var(--primary); color: #fff; font-size: 1.5rem; cursor: pointer; }
    .mode-btn.selected { background: var(--success); }
    #startQuiz { width: 100%; padding: 1rem; font-size: 1.2rem; border: none; border-radius: var(--radius); background: var(--primary); color: #fff; cursor: pointer; }
    #startQuiz.hidden { display: none; }
    .input-group { display: flex; gap: 0.5rem; align-items: center; }
    input[type=number] { width: 4rem; padding: 0.4rem; border: 1px solid #ccc; border-radius: var(--radius); }
    #scoreboard, #mainScoreboard, #levelDisplay { text-align: center; font-size: 1.2rem; }
    #scoreboard { visibility: hidden; }
    #question { width: 100%; text-align: center; font-size: 1.5em; direction: ltr; }
    .option-btn { display: block; width: 100%; padding: 1rem; margin: 0.5rem 0; border: none; border-radius: var(--radius); cursor: pointer; font-size: 1.5rem; }
    .option-btn.opt1 { background: var(--opt1); }
    .option-btn.opt2 { background: var(--opt2); }
    .option-btn.opt3 { background: var(--opt3); }
    .option-btn.opt4 { background: var(--opt4); }
    .option-btn.correct { background: var(--success) !important; color: #fff; }
    .option-btn.wrong { background: var(--error) !important; color: #fff; }
    .reset-small { width: auto; font-size: 0.8rem; padding: 0.4rem 0.8rem; align-self: flex-end; }
    #detailModal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); align-items: center; justify-content: center; }
    #detailModal.show { display: flex; }
    .modal-content { background: #fff; padding: 1rem; border-radius: var(--radius); width: 90%; max-width: 400px; }
    @keyframes zigzagUp {
      0%   { opacity: 1; transform: translate(0,0) rotate(0deg); }
      25%  { transform: translate(-0.5rem,-2rem) rotate(-2deg); }
      50%  { transform: translate(0,-5rem) rotate(2deg); }
      75%  { transform: translate(0.5rem,-8rem) rotate(-2deg); }
      100% { opacity: 0; transform: translate(0,-15rem) rotate(0deg); }
    }
    .zigzagUp { position: absolute; display: inline-block; pointer-events: none; z-index: 1000; animation: zigzagUp 1s ease-out forwards; transform-origin: center center; }
    .zigzagPositive { color: var(--success); font-size: 3rem; font-weight: bold; }
    .zigzagNegative { color: var(--error); font-size: 2rem; font-weight: bold; }
  </style>
</head>
<body>
<main>
  <h1>ğŸ† ×ª×¨×’×•×œ ×—×©×‘×•×Ÿ ×× ×¦×—</h1>
  <section id="mainMenu" class="active">
    <button id="openSettings">âš™ï¸</button>
    <div id="mainScoreboard">× ×§×•×“×•×ª ××¦×˜×‘×¨×•×ª: <span id="mainScore">0</span></div>
    <div id="levelDisplay">×¨××”: <span id="level">1</span></div>
    <div class="modes-row">
      <button class="mode-btn" data-type="add">â•</button>
      <button class="mode-btn" data-type="sub">â–</button>
    </div>
    <div class="modes-row">
      <button class="mode-btn" data-type="mul">âœ–ï¸</button>
      <button class="mode-btn" data-type="div">â—</button>
    </div>
    <button class="mode-btn" data-type="mix">ğŸ”€</button>
    <button id="startQuiz" class="hidden">×”×ª×—×œ ×‘×ª×¨×’×•×œ</button>
  </section>
  <section id="setup">
    <button id="closeSetup">âœ–ï¸</button>
    <h2>×”×’×“×¨×•×ª ×”×ª×¨×’×•×œ</h2>
    <div class="input-group"><label for="min">×</label><input id="min" type="number" min="1" value="1"></div>
    <div class="input-group"><label for="max">×¢×“</label><input id="max" type="number" min="1" value="10"></div>
    <div class="input-group"><label for="count">××¡×¤×¨ ×ª×¨×’×™×œ×™×</label><input id="count" type="number" min="1" value="20"></div>
    <div class="input-group"><label for="timePerQ">×–××Ÿ ×œ×©××œ×” (×©× ×™×•×ª)</label><input id="timePerQ" type="number" min="1" value="12"></div>
    <button id="applySettings" class="hidden">×©××•×¨ ×”×’×“×¨×•×ª</button>
    <button id="resetScore" class="primary reset-small">××¤×¡ × ×™×§×•×“</button>
  </section>
  <section id="quiz">
    <div id="scoreboard">× ×§×•×“×•×ª: <span id="score">0</span></div>
    <h2>×ª×¨×’×™×œ <span id="currentNum"></span> ××ª×•×š <span id="totalNum"></span></h2>
    <div><progress id="progress" max="100" value="0"></progress><span id="progressText">0%</span></div>
    <div id="timer">×–××Ÿ × ×•×ª×¨: <span id="timeDisplay"></span></div>
    <div id="question"></div>
    <div id="options"></div>
  </section>
  <section id="results">
    <h2>×”×ª×•×¦××•×ª ×©×œ×š</h2>
    <ul id="resultsList"></ul>
    <button id="restart" class="primary">× ×¡×” ×©×•×‘</button>
  </section>
</main>
<div id="detailModal"><div class="modal-content"><h3 id="detailTitle"></h3><p id="detailQuestion"></p><p id="detailYour"></p><p id="detailCorrect"></p><button id="detailClose" class="primary">×¡×’×•×¨</button></div></div>
<audio id="soundCorrect" src="https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"></audio>
<audio id="soundWrong" src="https://actions.google.com/sounds/v1/cartoon/metal_hit_and_slide.ogg"></audio>
<audio id="soundCheer" src="https://actions.google.com/sounds/v1/cartoon/cheer.ogg"></audio>
<script>
document.addEventListener('DOMContentLoaded', () => {
  const screens = {
    mainMenu: document.getElementById('mainMenu'),
    setup: document.getElementById('setup'),
    quiz: document.getElementById('quiz'),
    results: document.getElementById('results')
  };
  function showScreen(name) {
    Object.values(screens).forEach(s => s.classList.remove('active'));
    screens[name].classList.add('active');
  }
  let settings = {min:1, max:10, count:20, perQ:12};
  let selectedTypes = new Set();
  const modeBtns = document.querySelectorAll('.mode-btn');
  const openSettings = document.getElementById('openSettings');
  const closeSetup = document.getElementById('closeSetup');
  const applySettings = document.getElementById('applySettings');
  const startQuiz = document.getElementById('startQuiz');
  const resetScore = document.getElementById('resetScore');
  const restart = document.getElementById('restart');
  const detailClose = document.getElementById('detailClose');
  const scoreBoard = document.getElementById('scoreboard');
  const scoreEl = document.getElementById('score');
  const mainScoreEl = document.getElementById('mainScore');
  const levelEl = document.getElementById('level');
  const currentNumEl = document.getElementById('currentNum');
  const totalNumEl = document.getElementById('totalNum');
  const questionEl = document.getElementById('question');
  const optionsEl = document.getElementById('options');
  const timerEl = document.getElementById('timeDisplay');
  const progressBar = document.getElementById('progress');
  const progressText = document.getElementById('progressText');
  const resultsList = document.getElementById('resultsList');
  const soundC = document.getElementById('soundCorrect');
  const soundW = document.getElementById('soundWrong');
  const soundCh = document.getElementById('soundCheer');
  let exercises = [], answers = [], userAnswers = [], currentIndex = 0, countdown;
  let score = parseInt(localStorage.getItem('cumScore')) || 0;
  let level = parseInt(localStorage.getItem('level')) || 1;  
  mainScoreEl.textContent = score;
  levelEl.textContent = level;
  
  modeBtns.forEach(btn => {
    btn.addEventListener('click', () => {
      const type = btn.dataset.type;
      if (type === 'mix') {
        selectedTypes.clear();
        modeBtns.forEach(b => b.classList.remove('selected'));
        selectedTypes.add('mix');
        btn.classList.add('selected');
      } else {
        if (selectedTypes.has('mix')) {
          selectedTypes.delete('mix');
          document.querySelector('[data-type="mix"]').classList.remove('selected');
        }
        if (selectedTypes.has(type)) {
          selectedTypes.delete(type);
          btn.classList.remove('selected');
        } else {
          selectedTypes.add(type);
          btn.classList.add('selected');
        }
        const basic = ['add','sub','mul','div'];
        if (basic.every(t => selectedTypes.has(t))) {
          basic.forEach(t => { selectedTypes.delete(t); document.querySelector(`[data-type="${t}"]`).classList.remove('selected'); });
          selectedTypes.add('mix');
          document.querySelector('[data-type="mix"]').classList.add('selected');
        }
      }
      startQuiz.classList.toggle('hidden', selectedTypes.size === 0);
    });
  });

  openSettings.addEventListener('click', () => {
    applySettings.classList.add('hidden'); showScreen('setup');
    applySettings.classList.add('hidden'); });
  closeSetup.addEventListener('click', () => showScreen('mainMenu'));
  ['min','max','count','timePerQ'].forEach(id => {
    document.getElementById(id).addEventListener('input', () => {
      applySettings.classList.remove('hidden');
    });
  });
  applySettings.addEventListener('click', () => {
    settings.min = Math.max(1, Math.ceil(+document.getElementById('min').value));
    settings.max = Math.max(1, Math.ceil(+document.getElementById('max').value));
    settings.count = Math.max(1, Math.ceil(+document.getElementById('count').value));
    settings.perQ = Math.max(1, Math.ceil(+document.getElementById('timePerQ').value));
    applySettings.classList.add('hidden');
    showScreen('mainMenu');
    applySettings.classList.add('hidden');
  });
  resetScore.addEventListener('click', () => {
    if(confirm('×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××¤×¡ ××ª ×”× ×§×•×“?')) {
      score = 0; level = 1;
      localStorage.setItem('cumScore', score);
      localStorage.setItem('level', level);
      scoreEl.textContent = score; mainScoreEl.textContent = score;
      levelEl.textContent = level;
    }
  });

  startQuiz.addEventListener('click', () => {
    exercises = Array.from({length: settings.count}, () => gen(Array.from(selectedTypes), settings.min, settings.max));
    answers = []; userAnswers = []; currentIndex = 0;
    totalNumEl.textContent = exercises.length;
    scoreBoard.style.visibility = 'visible';
    scoreEl.textContent = score; mainScoreEl.textContent = score;
    levelEl.textContent = level;
    showScreen('quiz');
    showQuestion();
  });
  restart.addEventListener('click', () => showScreen('mainMenu'));
  detailClose.addEventListener('click', () => document.getElementById('detailModal').classList.remove('show'));

  function gen(types, min, max) {
    const ops = types.includes('mix') ? ['add','sub','mul','div'] : types;
    const op = ops[Math.floor(Math.random()*ops.length)];
    let A = Math.floor(Math.random()*(max-min+1))+min;
    let B = Math.floor(Math.random()*(max-min+1))+min;
    if (op==='div') {
      const res = Math.floor(Math.random()*(max-min+1))+min||1;
      B = Math.max(1, B); A = res * B;
    }
    let q, ans;
    switch(op) {
      case 'add': ans=A+B; q=`${A} + ${B}`; break;
      case 'sub': if(A<B)[A,B]=[B,A]; ans=A-B; q=`${A} - ${B}`; break;
      case 'mul': ans=A*B; q=`${A} Ã— ${B}`; break;
      case 'div': ans=A/B; q=`${A} Ã· ${B}`; break;
    }
    return {q, ans};
  }

  function showQuestion() {
    clearInterval(countdown);
    const {q, ans} = exercises[currentIndex];
    currentNumEl.textContent = currentIndex+1;
    questionEl.textContent = q;
    optionsEl.innerHTML = '';
    answers.push(ans);
    const choices = new Set([ans]);
    while(choices.size<4) {
      let c = Math.floor(Math.random()*((ans+10)-(ans-10)+1))+(ans-10);
      if(c>=0) choices.add(c);
    }
    Array.from(choices).sort(()=>Math.random()-0.5).forEach((val,i) => {
      const btn = document.createElement('button');
      btn.textContent = val; btn.className = `option-btn opt${i+1}`;
      btn.addEventListener('click',()=>selectAnswer(btn,val,ans));
      optionsEl.append(btn);
    });
    const pct=Math.round((currentIndex/exercises.length)*100);
    progressBar.value=pct; progressText.textContent=`${pct}%`;
    timerEl.textContent=settings.perQ;
    countdown=setInterval(()=>{
      let t=+timerEl.textContent-1; timerEl.textContent=t;
      if(t<=0){ clearInterval(countdown); selectAnswer(null,null,ans);}
    },1000);
  }

  function selectAnswer(btn, val, correct) {
    clearInterval(countdown); userAnswers.push(val);
    optionsEl.querySelectorAll('button').forEach(b=>{ b.disabled=true; if(+b.textContent===correct) b.classList.add('correct'); });
    let delta=0;
    if(btn && val===correct) {
      soundC.play(); const rawPts=Math.ceil(+timerEl.textContent*2);
      const pts=Math.min(rawPts,20);
      score+=pts; delta=pts;
      scoreEl.textContent=score; mainScoreEl.textContent=score;
      localStorage.setItem('cumScore',score);
      // level-up
      if(score>=1000){ score-=1000; level++; levelEl.textContent=level; localStorage.setItem('level',level); }
      // positive animation
      const fly=document.createElement('span');
      fly.textContent='+'+pts; fly.className='zigzagUp zigzagPositive';
      document.body.appendChild(fly);
      const r=btn.getBoundingClientRect(); fly.style.left=(r.left+r.width/2)+'px'; fly.style.top=r.top+'px';
      fly.addEventListener('animationend',()=>fly.remove(),{once:true});
    } else {
      if(btn){ btn.classList.add('wrong'); soundW.play(); }
      score-=4; delta=-4;
      scoreEl.textContent=score; mainScoreEl.textContent=score;
      localStorage.setItem('cumScore',score);
      // level-up for negative? no
      // negative animation
      const flyw=document.createElement('span');
      flyw.textContent=delta; flyw.className='zigzagUp zigzagNegative';
      document.body.appendChild(flyw);
      const r=btn?btn.getBoundingClientRect():{left:window.innerWidth/2,width:0,top:window.innerHeight/2};
      flyw.style.left=(r.left+r.width/2)+'px'; flyw.style.top=r.top+'px';
      flyw.addEventListener('animationend',()=>flyw.remove(),{once:true});
    }
    setTimeout(()=>{
      if(currentIndex+1<exercises.length){ currentIndex++; showQuestion(); }
      else {
        showScreen('results'); resultsList.innerHTML='';
        exercises.forEach((ex,i)=>{
          const li=document.createElement('li');
          li.textContent=`×ª×¨×’×™×œ ${i+1}`; li.addEventListener('click',()=>{
            document.getElementById('detailTitle').textContent=`×ª×¨×’×™×œ ${i+1}`;
            document.getElementById('detailQuestion').textContent=`×©××œ×”: ${ex.q}`;
            document.getElementById('detailYour').textContent=`×ª×©×•×‘×ª×š: ${userAnswers[i]}`;
            document.getElementById('detailCorrect').textContent=`×ª×©×•×‘×” × ×›×•× ×”: ${answers[i]}`;
            document.getElementById('detailModal').classList.add('show');
          });
          resultsList.append(li);
        });
        soundCh.play();
      }
    },1000);
  }
});
</script>
